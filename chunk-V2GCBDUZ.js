import{a as cn,b as Ne,c as de,d as Pe,h as Mt,i as Vt}from"./chunk-FM6UJ3BX.js";import{b as Ie,h as Dt}from"./chunk-SSJBLLWN.js";import{$ as re,$a as ae,Cb as Ct,Da as Te,Ea as m,Eb as bt,Fb as I,Ga as ot,Gb as D,Ha as st,Hb as N,Ka as M,La as Se,Ma as U,Na as at,O as Ee,Oa as J,P as w,Pa as lt,Q as Ae,Ra as ut,S as j,Ua as Fe,V as z,Va as x,Wa as Y,Xa as ct,Ya as B,Za as dt,a as v,aa as k,ab as le,b,ba as L,bb as g,cb as _,d as un,db as V,e as Ze,ea as it,eb as ue,fb as E,gb as Oe,ja as oe,k as Xe,kb as ft,lb as ht,ma as rt,mb as mt,n as et,na as $,nb as pt,oa as we,ob as gt,pa as f,qb as C,rb as ce,s as tt,tb as yt,ub as _t,vb as vt,wb as xe,xa as se,y as nt,za as y}from"./chunk-AVQYGBUL.js";var on=un((Ye,Ke)=>{"use strict";(function(i,e){typeof define=="function"&&define.amd?define([],e):typeof Ye<"u"?e():(e(),i.FileSaver={})})(Ye,function(){"use strict";function i(s,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}function e(s,l,u){var d=new XMLHttpRequest;d.open("GET",s),d.responseType="blob",d.onload=function(){a(d.response,l,u)},d.onerror=function(){console.error("could not download file")},d.send()}function t(s){var l=new XMLHttpRequest;l.open("HEAD",s,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function n(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(l)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,o=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(s,l,u){var d=r.URL||r.webkitURL,c=document.createElement("a");l=l||s.name||"download",c.download=l,c.rel="noopener",typeof s=="string"?(c.href=s,c.origin===location.origin?n(c):t(c.href)?e(s,l,u):n(c,c.target="_blank")):(c.href=d.createObjectURL(s),setTimeout(function(){d.revokeObjectURL(c.href)},4e4),setTimeout(function(){n(c)},0))}:"msSaveOrOpenBlob"in navigator?function(s,l,u){if(l=l||s.name||"download",typeof s!="string")navigator.msSaveOrOpenBlob(i(s,u),l);else if(t(s))e(s,l,u);else{var d=document.createElement("a");d.href=s,d.target="_blank",setTimeout(function(){n(d)})}}:function(s,l,u,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof s=="string")return e(s,l,u);var c=s.type==="application/octet-stream",P=/constructor/i.test(r.HTMLElement)||r.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||c&&P||o)&&typeof FileReader<"u"){var R=new FileReader;R.onloadend=function(){var q=R.result;q=p?q:q.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=q:location=q,d=null},R.readAsDataURL(s)}else{var Ve=r.URL||r.webkitURL,O=Ve.createObjectURL(s);d?d.location=O:location.href=O,d=null,setTimeout(function(){Ve.revokeObjectURL(O)},4e4)}});r.saveAs=a.saveAs=a,typeof Ke<"u"&&(Ke.exports=a)})});var T={json:"json",typeorm:"typeorm",prisma:"prisma"},Yn=Object.values(T),Et={json:{id:"json",label:"JSON",description:"Json representation of the database schema",icon:"curly-braces",classNames:"bg-json"},typeorm:{id:"typeorm",label:"TypeORM",description:"TypeORM entities code",icon:"typeorm",classNames:"bg-typeorm"},prisma:{id:"prisma",label:"Prisma",description:"Prisma schema code",icon:"prisma",classNames:"bg-prisma"}};function At(i){return JSON.stringify(i,null,2)}var Re={">":{from:"many",to:"one"},"<":{from:"one",to:"many"},"<>":{from:"many",to:"many"},"-":{from:"one",to:"one"}};var K={PrimaryKey:["pk","primary key"],Unique:["unique"],NotNull:["not null","nn"],Increment:["increment","auto_increment","identity"]},h={Integer:["int","integer","bigint","smallint","tinyint"],String:["varchar","char","text","string"],Date:["date","datetime","timestamp","time"],Boolean:["bool","boolean"],Float:["float","double","decimal","real"],Json:["json","jsonb"]},ke={from:"one",to:"one"},S=["created_at","createdat","creation_date"],F=["updated_at","updatedat","modification_date"],fe=["deleted_at","deletedat","deletion_date"],he=["time","timestamp","timestamptz","datetime"];function wt(i){let e={};for(let t of i){let n=t.toLowerCase().trim();K.PrimaryKey.includes(n)&&(e.pk=!0),K.Unique.includes(n)&&(e.unique=!0),K.NotNull.includes(n)&&(e.nullable=!1),K.Increment.includes(n)&&(e.increment=!0)}return e}var me=class i{dbmlContent=f("");parsedSchema=f(null);schema=D(()=>this.parsedSchema());constructor(){N(()=>{let e=this.dbmlContent();this.parsedSchema.set(this.parseDbmlToJson(e))})}setDbmlContent(e){this.dbmlContent.set(e)}parseDbmlToJson(e){if(!e.trim())return{tables:[],relations:[]};let t=e.split(`
`),n={tables:[],relations:[]},r=null;for(let o of t){if(o=o.trim(),!o||o.startsWith("//"))continue;let a=o.match(/Table\s+([\w_]+)\s*\{/);if(a){r={name:a[1],alias:null,columns:[]},n.tables.push(r);continue}if(o==="}"&&r){r=null;continue}if(r){let l=this.parseColumnLine(o);if(l&&(r.columns.push(l),l.ref)){let u=this.determineRelationCardinalityFromRef(l.ref);n.relations.push({from:{table:r.name,column:l.name},to:{table:l.ref.table,column:l.ref.column},cardinality:u})}continue}let s=o.match(/Ref(?:\s+(\w+))?\s*:?\s*([\w_]+)\.([\w_]+)\s*([<>-]+)\s*([\w_]+)\.([\w_]+)/);if(console.log("relationMatch:",s),s){let l=this.parseRelationshipLine(o);if(l&&(n.relations.push(l),l.cardinality.from==="many"&&l.cardinality.to==="many")){let u=s[1]||`${l.from.table}_${l.to.table}`;this.detectJunctionTable(n,l,u)}}}return this.addMissingForeignKeyColumns(n),this.deduplicateRelations(n)}determineRelationCardinalityFromRef(e){let t={from:"many",to:"one"};return e.cardinality||t}detectJunctionTable(e,t,n){if(t.cardinality.from!=="many"||t.cardinality.to!=="many")return;let r=e.tables.find(c=>c.name===n),o=e.tables.find(c=>c.name===t.from.table),a=e.tables.find(c=>c.name===t.to.table),s=o?.columns.find(c=>c.name===t.from.column),l=a?.columns.find(c=>c.name===t.to.column),u=`${t.from.table}_${t.from.column}`,d=`${t.to.table}_${t.to.column}`;if(r){let c=!1,P=!1;for(let p of r.columns)p.ref?.table===t.from.table&&p.ref?.column===t.from.column&&(c=!0,p.pk||(p.pk=!0)),p.ref?.table===t.to.table&&p.ref?.column===t.to.column&&(P=!0,p.pk||(p.pk=!0));c||r.columns.push({name:u,type:s?.type||"int",pk:!0,ref:{table:t.from.table,column:t.from.column,cardinality:{from:"many",to:"one"}}}),P||r.columns.push({name:d,type:l?.type||"int",pk:!0,ref:{table:t.to.table,column:t.to.column,cardinality:{from:"many",to:"one"}}})}else e.tables.push({name:n,alias:null,columns:[{name:u,type:s?.type||"int",pk:!0,ref:{table:t.from.table,column:t.from.column,cardinality:{from:"many",to:"one"}}},{name:d,type:l?.type||"int",pk:!0,ref:{table:t.to.table,column:t.to.column,cardinality:{from:"many",to:"one"}}}]})}addMissingForeignKeyColumns(e){for(let t of e.relations){if(t.cardinality.from==="many"&&t.cardinality.to==="many")continue;let n=e.tables.find(o=>o.name===t.from.table);if(!n)continue;let r=n.columns.find(o=>o.name===t.from.column);if(r)r.ref||(r.ref={table:t.to.table,column:t.to.column,cardinality:t.cardinality});else{let a=e.tables.find(s=>s.name===t.to.table)?.columns.find(s=>s.name===t.to.column);a&&n.columns.push({name:`${t.to.table}_${t.to.column}`,type:a.type,ref:{table:t.to.table,column:t.to.column,cardinality:t.cardinality}})}}}deduplicateRelations(e){let t=e.relations.filter((n,r,o)=>r===o.findIndex(a=>a.from.table===n.from.table&&a.from.column===n.from.column&&a.to.table===n.to.table&&a.to.column===n.to.column));return b(v({},e),{relations:t})}parseColumnLine(e){let t=e.match(/([\w_]+)\s+([\w\(\)]+)\s*\[([^\]]+)\]/);if(t){let[,r,o,a]=t,s={name:r,type:o},l=a.split(",").map(u=>u.trim());return Object.assign(s,wt(l)),this.parseAttributes(s,l),s}let n=e.match(/([\w_]+)\s+([\w\(\)]+)/);if(n){let[,r,o]=n;return{name:r,type:o}}return null}parseAttributes(e,t){for(let n of t)this.parseReference(n,e),this.parseDefault(n,e),this.parseNote(n,e)}parseReference(e,t){let n=e.match(/ref:\s*(<>|<|>|-)\s*([\w_]+)\.([\w_]+)/);if(!n)return;console.log(n);let[,r,o,a]=n,s={table:o,column:a};s.cardinality=Re[r]??{from:"one",to:"one"},t.ref=s}parseDefault(e,t){let n=e.match(/default:\s*(.+)/i);if(!n)return;let r=n[1].trim(),o=!1;if((r.startsWith("'")&&r.endsWith("'")||r.startsWith('"')&&r.endsWith('"')||r.startsWith("`")&&r.endsWith("`"))&&(o=!0,r=r.slice(1,-1)),!r)return;if(o){t.default=r;return}let a=r.toLowerCase();if(a==="true"){t.default=!0;return}if(a==="false"){t.default=!1;return}let s=Number(r);if(!isNaN(s)){t.default=s;return}t.default=r}parseNote(e,t){let n=e.match(/note:\s*['"`](.+?)['"`]/);n&&(t.note=n[1])}parseRelationshipLine(e){let t=e.match(/Ref(?:\s+(\w+))?\s*:?\s*([\w_]+)\.([\w_]+)\s*([<>-]+)\s*([\w_]+)\.([\w_]+)/);if(!t)return null;let[,n,r,o,a,s,l]=t,u=ke;return u=Re[a]??ke,{from:{table:r,column:o},to:{table:s,column:l},cardinality:u}}static \u0275fac=function(t){return new(t||i)};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};function Le(i){let e=i.toLowerCase();return h.Integer.some(t=>e.includes(t))?"int":h.String.some(t=>e.includes(t))?"varchar":h.Date.some(t=>e.includes(t))?e.includes("stamp")?"timestamp":e.includes("time")?"time":"date":h.Boolean.some(t=>e.includes(t))?"boolean":h.Float.some(t=>e.includes(t))?"float":e.includes("decimal")?"decimal":h.Json.some(t=>e.includes(t))?"json":"varchar"}function Q(i){let e=i.toLowerCase();return h.Integer.some(t=>e.includes(t))?"number":h.String.some(t=>e.includes(t))?"string":h.Date.some(t=>e.includes(t))?"Date":h.Boolean.some(t=>e.includes(t))?"boolean":h.Float.some(t=>e.includes(t))?"number":h.Json.some(t=>e.includes(t))?"Record<string, any>":"string"}var pe=class i{generateCode(e,t={}){return{entities:this.generateEntities(e,t),module:this.generateModule(e,t)}}generateEntities(e,t={}){if(!e?.tables?.length)return{};let n={};for(let r of e.tables){let o=this.getEntityFileName(r.name),a=this.generateEntityClass(r,e);n[o]=a}return n}generateModule(e,t={}){if(!e?.tables?.length)return"";let n=e.tables.map(o=>{let a=this.getClassName(o.name),s=this.getEntityFileName(o.name).replace(".ts","");return`import { ${a} } from './${s}';`}).join(`
`),r=e.tables.map(o=>this.getClassName(o.name)).join(", ");return`import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
${n}

@Module({
  imports: [TypeOrmModule.forFeature([${r}])],
  exports: [TypeOrmModule],
})
export class DatabaseModule {}
`}generateEntityClass(e,t){let n=this.getClassName(e.name),r=[`import { Entity, ${this.getTypeOrmImports(e,t)} } from 'typeorm';`],o=this.getRelationImports(e,t);r.push(...o);let a=e.columns.map(u=>this.generateColumn(u,e,t)).join(`

  `),s=this.generateOneToManyRelations(e,t),l=[a,s].filter(Boolean).join(`

  `);return`${r.join(`
`)}

@Entity('${e.name}')
export class ${n} {
  ${l}
}
`}generateColumn(e,t,n){let r=Le(e.type),o=e.note?`/** ${e.note} */
  `:"",a=[];if(e.ref&&e.ref.cardinality?.from==="many"&&e.ref.cardinality?.to==="many"&&e.pk)return e.increment?a.push("@PrimaryGeneratedColumn('increment')"):a.push("@PrimaryColumn()"),`${o}${a.join(`
  `)}
  ${e.name}: ${Q(e.type)};`;if(e.ref){let l=n.tables.find(O=>O.name===e.ref?.table);if(!l)return"";let u=this.getClassName(l.name),d=this.getCamelCase(u),c=this.getClassName(t.name),P=this.getCamelCase(c),p=[];e.ref.onDelete&&p.push(`onDelete: '${e.ref.onDelete}'`),e.ref.onUpdate&&p.push(`onUpdate: '${e.ref.onUpdate}'`);let R=p.length?`, { ${p.join(", ")} }`:"";if(e.unique||e.ref.cardinality?.from==="one"&&e.ref.cardinality?.to==="one")a.push(`@OneToOne(() => ${u}, ${this.getCamelCase(u)} => ${this.getCamelCase(u)}.${P}${R})`,`@JoinColumn({ name: '${e.name}' })`);else{let O=this.getPluralCamelCase(c);a.push(`@ManyToOne(() => ${u}, ${this.getCamelCase(u)} => ${this.getCamelCase(u)}.${O}${R})`,`@JoinColumn({ name: '${e.name}' })`)}return`${o}${a.join(`
  `)}
  ${d}: ${u};`}if(e.pk)return e.increment?a.push("@PrimaryGeneratedColumn('increment')"):a.push("@PrimaryColumn()"),`${o}${a.join(`
  `)}
  ${e.name}: ${Q(e.type)};`;if(this.isTimestampColumn(e))return this.generateTimestampColumn(e,o);let s=[`type: '${r}'`];return e.nullable===!1&&s.push("nullable: false"),e.unique&&s.push("unique: true"),e.default!==void 0&&s.push(`default: ${JSON.stringify(e.default)}`),a.push(`@Column({ ${s.join(", ")} })`),`${o}${a.join(`
  `)}
  ${e.name}: ${Q(e.type)};`}getTypeOrmImports(e,t){let n=new Set(["Column"]);for(let s of e.columns)if(s.pk&&(s.increment?n.add("PrimaryGeneratedColumn"):n.add("PrimaryColumn")),s.ref&&(s.unique?n.add("OneToOne"):n.add("ManyToOne"),n.add("JoinColumn")),this.isTimestampColumn(s)){let l=s.name.toLowerCase();S.includes(l)&&n.add("CreateDateColumn"),F.includes(l)&&n.add("UpdateDateColumn"),fe.includes(l)&&n.add("DeleteDateColumn")}let r=t.tables.flatMap(s=>s.columns.filter(l=>l.ref?.table===e.name)),o=r.some(s=>!s.unique),a=r.some(s=>s.unique);return o&&n.add("OneToMany"),a&&n.add("OneToOne"),Array.from(n).join(", ")}getRelationImports(e,t){let n=new Set;for(let r of e.columns)if(r.ref){let o=t.tables.find(a=>a.name===r.ref?.table);if(o){let a=this.getClassName(o.name),s=this.getEntityFileName(o.name).replace(".ts","");n.add(`import { ${a} } from './${s}';`)}}for(let r of t.tables){if(r.name===e.name)continue;if(r.columns.filter(a=>a.ref?.table===e.name).length>0){let a=this.getClassName(r.name),s=this.getEntityFileName(r.name).replace(".ts","");n.add(`import { ${a} } from './${s}';`)}}return Array.from(n)}generateOneToManyRelations(e,t){let n=[];for(let r of t.tables){if(r.name===e.name)continue;let o=r.columns.filter(a=>a.ref?.table===e.name);for(let a of o){let s=this.getClassName(r.name),l=this.getClassName(e.name),u=this.getCamelCase(l);if(a.unique||a.ref?.cardinality?.from==="one"&&a.ref?.cardinality?.to==="one"){let c=this.getCamelCase(s);n.push(`@OneToOne(() => ${s}, ${this.getCamelCase(s)} => ${this.getCamelCase(s)}.${u})
  ${c}: ${s};`)}else{let c=this.getPluralCamelCase(s);n.push(`@OneToMany(() => ${s}, ${this.getCamelCase(s)} => ${this.getCamelCase(s)}.${u})
  ${c}: ${s}[];`)}}}return n.join(`

  `)}isTimestampColumn(e){let t=he.includes(e.type.toLowerCase()),n=S.concat(fe,F).includes(e.name.toLowerCase());return t&&n}generateTimestampColumn(e,t){let n=e.name.toLowerCase(),r=Q(e.type);return S.includes(n)?`${t}@CreateDateColumn({ type: 'timestamptz', default: () => 'CURRENT_TIMESTAMP' })
  ${e.name}: ${r};`:F.includes(n)?`${t}@UpdateDateColumn({ type: 'timestamptz', default: () => 'CURRENT_TIMESTAMP', onUpdate: 'CURRENT_TIMESTAMP' })
  ${e.name}: ${r};`:fe.includes(n)?`${t}@DeleteDateColumn({ type: 'timestamptz', nullable: true })
  ${e.name}: ${r};`:`${t}@Column({ type: '${Le(e.type)}' })
  ${e.name}: ${r};`}getClassName(e){return e.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join("")}getEntityFileName(e){return`${e}.entity.ts`}getCamelCase(e){return e.charAt(0).toLowerCase()+e.slice(1)}getPluralCamelCase(e){let t=this.getCamelCase(e);return t.endsWith("s")?t:`${t}s`}static \u0275fac=function(t){return new(t||i)};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};function Tt(i){let e=i.toLowerCase();return h.Integer.some(t=>e.includes(t))?"Int":h.String.some(t=>e.includes(t))?"String":h.Date.some(t=>e.includes(t))?"DateTime":h.Boolean.some(t=>e.includes(t))?"Boolean":h.Float.some(t=>e.includes(t))?"Float":h.Json.some(t=>e.includes(t))?"Json":"String"}var ge=class i{generateCode(e){let t=e.tables.map(n=>this.generateModel(n,e)).join(`

`);return{schema:this.generateSchemaFile(t)}}generateSchemaFile(e){return`generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

${e}
`}generateModel(e,t){let n=this.getModelName(e.name),r=this.isJunctionTable(e,t),o="";r&&(o=`id Int @id @default(autoincrement())
  `);let a=e.columns.map(u=>this.generateField(u,e,t,r)).filter(Boolean).join(`
  `);o+=a;let s=this.generateRelations(e,t),l=[o,s].filter(Boolean).join(`

  `);return`model ${n} {
  ${l}
}`}isJunctionTable(e,t){let n=e.columns.filter(o=>o.ref);return n.length<2?!1:new Set(n.map(o=>o.ref?.table).filter(Boolean)).size>=2}generateField(e,t,n,r){let o=e.name,a=this.mapToPrismaType(e),s=this.getFieldAttributes(e,t,n,r);return`${e.note?`/// ${e.note}
  `:""}${o} ${a}${s}`}mapToPrismaType(e){let t=Tt(e.type),n=e.default!==void 0||S.includes(e.name.toLowerCase())||F.includes(e.name.toLowerCase());return e.nullable===!0&&!n?`${t}?`:t}getFieldAttributes(e,t,n,r){let o=[];return e.pk&&!r&&(e.increment?o.push("@id @default(autoincrement())"):o.push("@id")),e.unique&&!e.pk&&o.push("@unique"),e.default!==void 0&&!e.increment&&(S.concat(F).includes(e.name.toLowerCase())&&he.includes(e.type.toLowerCase())||o.push(this.formatDefault(e.default,e.type))),S.includes(e.name.toLowerCase())&&o.push("@default(now())"),F.includes(e.name.toLowerCase())&&o.push("@updatedAt"),e.name.includes("_")&&o.push(`@map("${e.name}")`),o.length>0?` ${o.join(" ")}`:""}formatDefault(e,t){return typeof e=="string"?`@default("${e}")`:typeof e=="boolean"?`@default(${e})`:typeof e=="number"?`@default(${e})`:""}generateRelations(e,t){let n=[];for(let r of e.columns){if(!r.ref)continue;let o=t.tables.find(u=>u.name===r.ref?.table);if(!o||r.ref.cardinality?.from==="many"&&r.ref.cardinality?.to==="many")continue;let a=this.camelCase(o.name),s=this.getModelName(o.name),l=r.nullable===!0?"?":"";n.push(`${a} ${s}${l} @relation(fields: [${r.name}], references: [${r.ref.column}])`)}for(let r of t.tables){if(r.name===e.name)continue;let o=r.columns.filter(a=>a.ref?.table===e.name);for(let a of o){let s=this.getModelName(r.name),l=this.camelCase(r.name);a.ref?.cardinality?.from==="many"&&a.ref?.cardinality?.to==="many"||(a.unique?n.push(`${l} ${s}?`):n.push(`${l} ${s}[]`))}}return n.join(`
  `)}getModelName(e){return e.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join("")}camelCase(e){return e.split("_").map((n,r)=>r===0?n.toLowerCase():n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join("")}static \u0275fac=function(t){return new(t||i)};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};var St="input",Ft="output",$e={id:"schema-json",filename:"schema.json"},Ue={id:"schema-prisma",filename:"schema.prisma"},Be={id:"database-module",filename:"database.module.ts"};var Z={DBML_CONTENT:"dbml_content",OUTPUT_TYPE:"output_type"};var Ot=class i{dbmlParserService=z(me);nestjsGeneratorService=z(pe);prismaGeneratorService=z(ge);constructor(){N(()=>{let e=this.dbmlContent();this.saveToStorage(Z.DBML_CONTENT,e)}),N(()=>{let e=this.selectedOutputType();this.saveToStorage(Z.OUTPUT_TYPE,e)})}dbmlContent=f(this.loadFromStorage(Z.DBML_CONTENT)||"");selectedOutputType=f(this.loadOutputTypeFromStorage()||T.json);isConverting=f(!1);files=f([]);selectedFile=f(null);input=f("");expandedFolders=f(new Set);schema=this.dbmlParserService.schema;nestjsCode=D(()=>{let e=this.schema();return e?this.nestjsGeneratorService.generateCode(e):null});prismaSchema=D(()=>{let e=this.schema();return e?this.prismaGeneratorService.generateCode(e).schema:null});setDbmlContent(e){this.dbmlContent.set(e)}setOutputType(e){let t=Object.values(Et).find(n=>n.id===e);if(!t){console.warn(`Output type with id "${e}" not found`);return}this.selectedOutputType()!==e&&this.selectedOutputType.set(t.id)}handleConvert(){this.isConverting.set(!0),this.dbmlParserService.setDbmlContent(this.dbmlContent()),setTimeout(()=>{let e=this.schema();if(!e){this.isConverting.set(!1);return}let t=this.selectedOutputType(),n=[];switch(t){case T.json:n.push({id:$e.id,filename:$e.filename,content:At(e)});break;case T.typeorm:let o=this.nestjsCode();o&&(Object.entries(o.entities).forEach(([s,l])=>{n.push({id:`entity-${s}`,filename:s,content:l})}),t===T.typeorm&&n.push({id:Be.id,filename:Be.filename,content:o.module}));break;case T.prisma:let a=this.prismaGeneratorService.generateCode(e);n.push({id:Ue.id,filename:Ue.filename,content:a.schema});break}this.files.set(n);let r=new Set(this.expandedFolders());r.add(St),r.add(Ft),this.expandedFolders.set(r),this.isConverting.set(!1)},100)}clearAll(){this.dbmlContent.set(""),this.input.set(""),this.files.set([]),this.selectedFile.set(null)}onDbmlInput(e){this.dbmlContent.set(e)}saveToStorage(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(n){console.error("Error saving to localStorage:",n)}}loadFromStorage(e){try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.error("Error loading from localStorage:",t),null}}loadOutputTypeFromStorage(){try{let e=localStorage.getItem(Z.OUTPUT_TYPE);if(!e)return null;let t=JSON.parse(e);return Object.values(T).includes(t)?t:null}catch(e){return console.error("Error loading output type from localStorage:",e),null}}static \u0275fac=function(t){return new(t||i)};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};var xt=class i{transform(e){return e?e.replace(/[\n\t ]/g,"").length:0}static \u0275fac=function(t){return new(t||i)};static \u0275pipe=at({name:"codeChars",type:i,pure:!0})};var $t=(()=>{class i{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,n){this._renderer=t,this._elementRef=n}setProperty(t,n){this._renderer.setProperty(this._elementRef.nativeElement,t,n)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(n){return new(n||i)(m(Te),m(we))};static \u0275dir=U({type:i})}return i})(),dn=(()=>{class i extends $t{static \u0275fac=(()=>{let t;return function(r){return(t||(t=it(i)))(r||i)}})();static \u0275dir=U({type:i,features:[J]})}return i})(),Ut=new j("");var fn={provide:Ut,useExisting:Ee(()=>be),multi:!0};function hn(){let i=Ie()?Ie().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var mn=new j(""),be=(()=>{class i extends $t{_compositionMode;_composing=!1;constructor(t,n,r){super(t,n),this._compositionMode=r,this._compositionMode==null&&(this._compositionMode=!hn())}writeValue(t){let n=t??"";this.setProperty("value",n)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(n){return new(n||i)(m(Te),m(we),m(mn,8))};static \u0275dir=U({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,r){n&1&&E("input",function(a){return r._handleInput(a.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(a){return r._compositionEnd(a.target.value)})},standalone:!1,features:[xe([fn]),J]})}return i})();var pn=new j(""),gn=new j("");function Bt(i){return i!=null}function Gt(i){return ut(i)?et(i):i}function Ht(i){let e={};return i.forEach(t=>{e=t!=null?v(v({},e),t):e}),Object.keys(e).length===0?null:e}function Wt(i,e){return e.map(t=>t(i))}function yn(i){return!i.validate}function qt(i){return i.map(e=>yn(e)?e:t=>e.validate(t))}function _n(i){if(!i)return null;let e=i.filter(Bt);return e.length==0?null:function(t){return Ht(Wt(t,e))}}function zt(i){return i!=null?_n(qt(i)):null}function vn(i){if(!i)return null;let e=i.filter(Bt);return e.length==0?null:function(t){let n=Wt(t,e).map(Gt);return nt(n).pipe(tt(Ht))}}function Jt(i){return i!=null?vn(qt(i)):null}function It(i,e){return i===null?[e]:Array.isArray(i)?[...i,e]:[i,e]}function Cn(i){return i._rawValidators}function bn(i){return i._rawAsyncValidators}function Ge(i){return i?Array.isArray(i)?i:[i]:[]}function _e(i,e){return Array.isArray(i)?i.includes(e):i===e}function Nt(i,e){let t=Ge(e);return Ge(i).forEach(r=>{_e(t,r)||t.push(r)}),t}function Pt(i,e){return Ge(e).filter(t=>!_e(i,t))}var ve=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=zt(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Jt(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},He=class extends ve{name;get formDirective(){return null}get path(){return null}},ie=class extends ve{_parent=null;name=null;valueAccessor=null},We=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Dn={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},gr=b(v({},Dn),{"[class.ng-submitted]":"isSubmitted"}),Yt=(()=>{class i extends We{constructor(t){super(t)}static \u0275fac=function(n){return new(n||i)(m(ie,2))};static \u0275dir=U({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,r){n&2&&ct("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[J]})}return i})();var X="VALID",ye="INVALID",G="PENDING",ee="DISABLED",W=class{},Ce=class extends W{value;source;constructor(e,t){super(),this.value=e,this.source=t}},te=class extends W{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},ne=class extends W{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},H=class extends W{status;source;constructor(e,t){super(),this.status=e,this.source=t}};function Mn(i){return(De(i)?i.validators:i)||null}function Vn(i){return Array.isArray(i)?zt(i):i||null}function En(i,e){return(De(e)?e.asyncValidators:i)||null}function An(i){return Array.isArray(i)?Jt(i):i||null}function De(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}var qe=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return I(this.statusReactive)}set status(e){I(()=>this.statusReactive.set(e))}_status=D(()=>this.statusReactive());statusReactive=f(void 0);get valid(){return this.status===X}get invalid(){return this.status===ye}get pending(){return this.status==G}get disabled(){return this.status===ee}get enabled(){return this.status!==ee}errors;get pristine(){return I(this.pristineReactive)}set pristine(e){I(()=>this.pristineReactive.set(e))}_pristine=D(()=>this.pristineReactive());pristineReactive=f(!0);get dirty(){return!this.pristine}get touched(){return I(this.touchedReactive)}set touched(e){I(()=>this.touchedReactive.set(e))}_touched=D(()=>this.touchedReactive());touchedReactive=f(!1);get untouched(){return!this.touched}_events=new Xe;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Nt(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Nt(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Pt(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Pt(e,this._rawAsyncValidators))}hasValidator(e){return _e(this._rawValidators,e)}hasAsyncValidator(e){return _e(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(b(v({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new ne(!0,n))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=e.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&e.emitEvent!==!1&&this._events.next(new ne(!1,n))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(b(v({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new te(!1,n))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=e.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&e.emitEvent!==!1&&this._events.next(new te(!0,n))}markAsPending(e={}){this.status=G;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new H(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(b(v({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=ee,this.errors=null,this._forEachChild(r=>{r.disable(b(v({},e),{onlySelf:!0}))}),this._updateValue();let n=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ce(this.value,n)),this._events.next(new H(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(b(v({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=X,this._forEachChild(n=>{n.enable(b(v({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(b(v({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===X||this.status===G)&&this._runAsyncValidator(n,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ce(this.value,t)),this._events.next(new H(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(b(v({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?ee:X}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=G,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let n=Gt(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,r)=>n&&n._find(r),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new H(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new oe,this.statusChanges=new oe}_calculateStatus(){return this._allControlsDisabled()?ee:this.errors?ye:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(G)?G:this._anyControlsHaveStatus(ye)?ye:X}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let n=!this._anyControlsDirty(),r=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),r&&this._events.next(new te(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new ne(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){De(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=Vn(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=An(this._rawAsyncValidators)}};var Kt=new j("",{providedIn:"root",factory:()=>ze}),ze="always";function wn(i,e){return[...e.path,i]}function Tn(i,e,t=ze){Fn(i,e),e.valueAccessor.writeValue(i.value),(i.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(i.disabled),On(i,e),In(i,e),xn(i,e),Sn(i,e)}function Rt(i,e){i.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function Sn(i,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};i.registerOnDisabledChange(t),e._registerOnDestroy(()=>{i._unregisterOnDisabledChange(t)})}}function Fn(i,e){let t=Cn(i);e.validator!==null?i.setValidators(It(t,e.validator)):typeof t=="function"&&i.setValidators([t]);let n=bn(i);e.asyncValidator!==null?i.setAsyncValidators(It(n,e.asyncValidator)):typeof n=="function"&&i.setAsyncValidators([n]);let r=()=>i.updateValueAndValidity();Rt(e._rawValidators,r),Rt(e._rawAsyncValidators,r)}function On(i,e){e.valueAccessor.registerOnChange(t=>{i._pendingValue=t,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&Qt(i,e)})}function xn(i,e){e.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&Qt(i,e),i.updateOn!=="submit"&&i.markAsTouched()})}function Qt(i,e){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function In(i,e){let t=(n,r)=>{e.valueAccessor.writeValue(n),r&&e.viewToModelUpdate(n)};i.registerOnChange(t),e._registerOnDestroy(()=>{i._unregisterOnChange(t)})}function Nn(i,e){if(!i.hasOwnProperty("model"))return!1;let t=i.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function Pn(i){return Object.getPrototypeOf(i.constructor)===dn}function Rn(i,e){if(!e)return null;Array.isArray(e);let t,n,r;return e.forEach(o=>{o.constructor===be?t=o:Pn(o)?n=o:r=o}),r||n||t||null}function jt(i,e){let t=i.indexOf(e);t>-1&&i.splice(t,1)}function kt(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var jn=class extends qe{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,n){super(Mn(t),En(n,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),De(t)&&(t.nonNullable||t.initialValueIsDefault)&&(kt(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){jt(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){jt(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){kt(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var kn={provide:ie,useExisting:Ee(()=>Je)},Lt=Promise.resolve(),Je=(()=>{class i extends ie{_changeDetectorRef;callSetDisabledState;control=new jn;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new oe;constructor(t,n,r,o,a,s){super(),this._changeDetectorRef=a,this.callSetDisabledState=s,this._parent=t,this._setValidators(n),this._setAsyncValidators(r),this.valueAccessor=Rn(this,o)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let n=t.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),Nn(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Tn(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){Lt.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let n=t.isDisabled.currentValue,r=n!==0&&bt(n);Lt.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?wn(t,this._parent):[t]}static \u0275fac=function(n){return new(n||i)(m(He,9),m(pn,10),m(gn,10),m(Ut,10),m(Ct,8),m(Kt,8))};static \u0275dir=U({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[xe([kn]),J,re]})}return i})();var Ln=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Se({type:i});static \u0275inj=Ae({})}return i})();var Zt=(()=>{class i{static withConfig(t){return{ngModule:i,providers:[{provide:Kt,useValue:t.callSetDisabledState??ze}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=Se({type:i});static \u0275inj=Ae({imports:[Ln]})}return i})();var Bn=["editorTextarea"],Gn=(i,e)=>e.number;function Hn(i,e){if(i&1&&(C(0,`
      `),g(1,"div",8),C(2),_(),C(3,`
      `)),i&2){let t=e.$implicit;y(2),ce(t.number)}}var Xt=class i{constructor(e){this.prism=e;N(()=>{this.highlightCode()})}code=st(Pe);placeholder=$(Pe);height=$("400px");editorTextarea=ot("editorTextarea");highlighted=f("");scrollTop=f(0);scrollLeft=f(0);codeLines=D(()=>this.highlighted().split(`
`).map((t,n)=>({number:n+1,content:t||"&nbsp;"})));handleScroll(){if(!this.editorTextarea()?.nativeElement)return;let e=this.editorTextarea().nativeElement;this.scrollTop.set(e.scrollTop),this.scrollLeft.set(e.scrollLeft)}onKeyDown(e){if(e.key==="Tab"){if(e.preventDefault(),!this.code()){this.code.set(this.placeholder());return}let t=e.target,n=t.selectionStart,r=t.selectionEnd,o="	";this.code.set(this.code().substring(0,n)+o+this.code().substring(r)),setTimeout(()=>{t.selectionStart=t.selectionEnd=n+o.length},0)}}highlightCode(){this.highlighted.set(this.prism.highlight(this.code()))}static \u0275fac=function(t){return new(t||i)(m(de))};static \u0275cmp=M({type:i,selectors:[["app-dbml-code-editor"]],viewQuery:function(t,n){t&1&&pt(n.editorTextarea,Bn,5),t&2&&gt()},inputs:{code:[1,"code"],placeholder:[1,"placeholder"],height:[1,"height"]},outputs:{code:"codeChange"},decls:15,vars:9,consts:[["editorContainer",""],["editorTextarea",""],["outputElement",""],[1,"editor-container","editor-font","border","bg-bg-secondary","border-border-muted","rounded-sm"],["spellcheck","false","wrap","off",1,"editor-input","py-4","m-0","w-full","h-full","pl-12",3,"ngModelChange","keydown","scroll","ngModel","placeholder"],[1,"flex","editor-output","bg-bg-secondary","py-4","m-0"],[1,"flex","flex-col","items-end","w-8","pointer-events-none","z-3"],[1,"ml-4","language-dbml",3,"innerHTML"],[1,"num-lines"]],template:function(t,n){if(t&1){let r=ue();g(0,"div",3,0)(2,"textarea",4,1),vt("ngModelChange",function(a){return k(r),_t(n.code,a)||(n.code=a),L(a)}),E("keydown",function(a){return k(r),L(n.onKeyDown(a))})("scroll",function(){return k(r),L(n.handleScroll())}),_(),g(4,"pre",5,2),C(6,"  "),C(7,`
   `),C(8,`
    `),g(9,"div",6),C(10,`
      `),ae(11,Hn,4,1,null,null,Gn),_(),C(13,`
  `),V(14,"code",7),_()()}t&2&&(Y("height",n.height()),y(2),yt("ngModel",n.code),x("placeholder",n.placeholder()),y(2),Y("top",-n.scrollTop(),"px")("left",-n.scrollLeft(),"px"),y(7),le(n.codeLines()),y(3),x("innerHTML",n.highlighted(),se))},dependencies:[Zt,be,Yt,Je],styles:[".editor-font[_ngcontent-%COMP%]{font-family:Consolas,Monaco,Courier New,monospace;font-size:14px;line-height:1.5;tab-size:4}.editor-container[_ngcontent-%COMP%]{position:relative;min-height:200px;overflow:hidden}textarea.editor-input[_ngcontent-%COMP%]{box-sizing:border-box;color:transparent;caret-color:#fff;border:none;resize:none;overflow:auto;white-space:pre;position:absolute;top:0;left:0;z-index:2}textarea.editor-input[_ngcontent-%COMP%]:focus{outline:none}.editor-input[_ngcontent-%COMP%]::placeholder{color:#71717a}.num-lines[_ngcontent-%COMP%]{text-align:right;color:#71717a;-webkit-user-select:none;user-select:none;font-variant-numeric:tabular-nums;display:inline-block}.editor-output[_ngcontent-%COMP%]{box-sizing:border-box;white-space:pre;overflow:visible;position:absolute;top:0;left:0;z-index:1;pointer-events:none}"]})};var tn=Ze(cn());var en=class i{constructor(e){this.prismService=e}DEFAULT_PRISM_LANGUAGE=Ne;code="";language=Ne;height="200px";charsCount=0;highlightedCode="";ngOnChanges(e){(e.code||e.language)&&this.highlight()}highlight(){if(!this.code){this.highlightedCode="";return}let e=this.language in tn.default.languages?this.language:this.DEFAULT_PRISM_LANGUAGE;this.highlightedCode=this.prismService.highlight(this.code,e)}static \u0275fac=function(t){return new(t||i)(m(de))};static \u0275cmp=M({type:i,selectors:[["app-code-viewer"]],inputs:{code:"code",language:"language",height:"height"},features:[re],decls:3,vars:5,consts:[[1,"w-full","overflow-auto","border","border-border-muted","rounded-sm","bg-code-box-bg","text-text"],[1,"code-block","bg-code-box"],[3,"innerHTML"]],template:function(t,n){t&1&&(g(0,"div",0)(1,"pre",1),V(2,"code",2),_()()),t&2&&(Y("height",n.height),y(2),B("language-"+n.language),x("innerHTML",n.highlightedCode,se))},dependencies:[Dt],styles:[".code-block[_ngcontent-%COMP%]{margin:0;padding:1rem;font-family:monospace;font-size:14px;line-height:1.5;tab-size:4;white-space:pre}"]})};var Wn=["buttonRef"],qn=(i,e)=>e.id;function zn(i,e){if(i&1){let t=ue();g(0,"button",3,0),E("click",function(r){let o=k(t).$implicit,a=Oe();return L(a.handleButtonClick(o.id,r))}),V(2,"div",4)(3,"div",5),g(4,"span",6),C(5),_()()}if(i&2){let t=e.$implicit,n=Oe();B(n.getButtonClasses(t.id)),Fe("aria-pressed",n.isOptionSelected(t.id)),y(2),B(n.getExpandingCircleClasses(t.id)),y(),B(n.getIndicatorClasses(t.id)),y(2),ce(t.label)}}var nn=class i{options=$([]);selectedId=$("");optionSelected=rt();buttonRefs;isOptionSelected=e=>this.selectedId()===e;handleButtonClick(e,t){this.isOptionSelected(e)||this.optionSelected.emit(e)}getClassNames(e){return this.options().find(n=>n.id===e)?.classNames||""}getButtonClasses(e){let t=this.isOptionSelected(e),n=this.getClassNames(e);return t?"text-white shadow-lg "+n:" bg-gray-800 text-gray-300  hover:bg-gray-700"}getExpandingCircleClasses(e){let t=this.isOptionSelected(e),n=this.getClassNames(e);return t?"w-full h-full top-0 left-0 scale-150 "+n:"w-3 h-3 top-1/2 left-4 -translate-y-1/2 scale-100 "+n}getIndicatorClasses(e){let t=this.isOptionSelected(e),n=this.getClassNames(e);return t?"bg-white border border-white/50":n}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=M({type:i,selectors:[["app-expanding-circle-button"]],viewQuery:function(t,n){if(t&1&&ft(Wn,5),t&2){let r;ht(r=mt())&&(n.buttonRefs=r)}},hostAttrs:[1,"block"],inputs:{options:[1,"options"],selectedId:[1,"selectedId"]},outputs:{optionSelected:"optionSelected"},decls:3,vars:0,consts:[["buttonRef",""],[1,"flex","space-x-2"],["type","button",1,"group","relative","px-4","py-1.5","text-sm","font-medium","rounded-lg","flex","items-center","overflow-hidden","transition-all","duration-300","ease-out",3,"class"],["type","button",1,"group","relative","px-4","py-1.5","text-sm","font-medium","rounded-lg","flex","items-center","overflow-hidden","transition-all","duration-300","ease-out",3,"click"],[1,"absolute","rounded-full","transition-all","duration-500","ease-out"],[1,"indicator","h-3","w-3","rounded-full","mr-2","relative","z-10","transition-all","duration-300"],[1,"label","relative","z-10","font-medium"]],template:function(t,n){t&1&&(g(0,"div",1),ae(1,zn,6,8,"button",2,qn),_()),t&2&&(y(),le(n.options()))},styles:["button[_ngcontent-%COMP%]{position:relative;overflow:hidden;z-index:1;transition:all .3s ease}button[_ngcontent-%COMP%]:focus-visible{outline:2px solid rgba(66,153,225,.6);outline-offset:2px}button[_ngcontent-%COMP%]:focus:not(:focus-visible){outline:none;box-shadow:0 0 0 3px #4299e180}.indicator[_ngcontent-%COMP%]{transition:transform .2s ease-out}button[_ngcontent-%COMP%]:hover:not([aria-pressed=true])   .indicator[_ngcontent-%COMP%]{transform:scale(1.2)}@keyframes _ngcontent-%COMP%_ripple{0%{transform:translate(-50%,-50%) scale(0);opacity:.7}to{transform:translate(-50%,-50%) scale(1);opacity:0}}.ripple[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_ripple .6s cubic-bezier(.4,0,.2,1) forwards;pointer-events:none;z-index:1}"]})};function Jn(i,e){i&1&&(g(0,"span",0),C(1,"Copied!"),_())}var rn=class i{textToCopy="";isCopied=f(!1);copyTimeout=null;copyToClipboard(e){e.stopPropagation(),navigator.clipboard.writeText(this.textToCopy).then(()=>{this.isCopied.set(!0),this.copyTimeout&&clearTimeout(this.copyTimeout),this.copyTimeout=setTimeout(()=>{this.isCopied.set(!1),this.copyTimeout=null},2e3)})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=M({type:i,selectors:[["copy-file-button"]],hostAttrs:[1,"flex","gap-1","items-center"],inputs:{textToCopy:"textToCopy"},decls:3,vars:2,consts:[[1,"text-sm","text-accent","select-none"],[1,"inline-flex","items-center","justify-center","whitespace-nowrap","text-sm","font-medium","transition-all","outline-none","rounded-md","gap-1.5","h-6","w-6","p-0","hover:bg-hover-muted",3,"click"],["title","Copy to clipboard",3,"className"]],template:function(t,n){t&1&&(lt(0,Jn,2,0,"span",0),g(1,"button",1),E("click",function(o){return n.copyToClipboard(o)}),V(2,"copy-icon",2),_()),t&2&&(dt(n.isCopied()?0:-1),y(2),x("className",n.isCopied()?"w-4 h-4 text-accent":"w-4 h-4 text-text"))},dependencies:[Mt],encapsulation:2})};var ln=Ze(on());var sn={ts:"text/typescript",json:"application/json",sql:"application/sql",txt:"text/plain"},Qe="text/plain";var an=class i{textToDownload="";fileName="file.txt";onDownload(e){e.stopPropagation();let t=this.getMimeType(this.fileName),n=new Blob([this.textToDownload],{type:t});(0,ln.saveAs)(n,this.fileName)}getMimeType(e){if(!e||e.indexOf(".")===-1)return Qe;let t=e.split(".").pop()?.toLowerCase();return sn[t||""]||Qe}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=M({type:i,selectors:[["download-file-button"]],hostAttrs:[1,"flex","items-center"],inputs:{textToDownload:"textToDownload",fileName:"fileName"},decls:2,vars:0,consts:[[1,"inline-flex","items-center","justify-center","whitespace-nowrap","text-sm","font-medium","transition-all","outline-none","rounded-md","gap-1.5","h-6","w-6","p-0","hover:bg-hover-muted",3,"click"],["title","Download","className","w-4 h-4 text-text"]],template:function(t,n){t&1&&(g(0,"button",0),E("click",function(o){return n.onDownload(o)}),V(1,"download-icon",1),_())},dependencies:[Vt],encapsulation:2})};export{T as a,Et as b,At as c,Ot as d,xt as e,Xt as f,en as g,nn as h,rn as i,on as j,an as k};
